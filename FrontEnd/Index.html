<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
<div id="app">
    <!-- Login Screen -->
    <div v-if="!isAuthenticated" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg w-96">
            <h1 class="text-3xl font-bold text-center mb-6 text-blue-600">Course Platform</h1>
            <form @submit.prevent="login" class="space-y-4">
                <input
                        v-model="loginData.email"
                        type="email"
                        placeholder="Email"
                        required
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <input
                        v-model="loginData.password"
                        type="password"
                        placeholder="Password"
                        required
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                <button
                        type="submit"
                        class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                    Login
                </button>
            </form>
            <p class="text-sm text-gray-600 text-center mt-4">
                Usuario: test@courseplatform.com / Test123!
            </p>
            <div v-if="loginError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg text-sm">
                {{ loginError }}
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div v-else>
        <!-- Navigation -->
        <nav class="bg-blue-600 text-white shadow-lg">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <h1 class="text-2xl font-bold">Course Platform</h1>
                    <button
                            @click="currentView = 'dashboard'"
                            :class="currentView === 'dashboard' ? 'bg-blue-700' : ''"
                            class="px-4 py-2 rounded hover:bg-blue-700 transition">
                        üìä Dashboard
                    </button>
                    <button
                            @click="currentView = 'courses'; loadCourses()"
                            :class="currentView === 'courses' ? 'bg-blue-700' : ''"
                            class="px-4 py-2 rounded hover:bg-blue-700 transition">
                        üìö Cursos
                    </button>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">{{ userEmail }}</span>
                    <button
                            @click="logout"
                            class="bg-red-500 px-4 py-2 rounded hover:bg-red-600 transition">
                        Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard -->
        <div v-if="currentView === 'dashboard'" class="container mx-auto px-4 py-8">
            <h2 class="text-3xl font-bold mb-6">Dashboard</h2>

            <!-- Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Cursos</p>
                            <p class="text-3xl font-bold text-blue-600">{{ metrics.totalCourses }}</p>
                        </div>
                        <div class="text-4xl">üìö</div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Publicados</p>
                            <p class="text-3xl font-bold text-green-600">{{ metrics.publishedCourses }}</p>
                        </div>
                        <div class="text-4xl">‚úÖ</div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Borradores</p>
                            <p class="text-3xl font-bold text-yellow-600">{{ metrics.draftCourses }}</p>
                        </div>
                        <div class="text-4xl">üìù</div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-500 text-sm">Total Lecciones</p>
                            <p class="text-3xl font-bold text-purple-600">{{ metrics.totalLessons }}</p>
                        </div>
                        <div class="text-4xl">üìñ</div>
                    </div>
                </div>
            </div>

            <!-- Recent Courses -->
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-xl font-bold mb-4">Cursos Recientes</h3>
                <div class="space-y-3">
                    <div v-for="course in metrics.recentCourses" :key="course.id"
                         class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                        <div>
                            <h4 class="font-semibold">{{ course.title }}</h4>
                            <p class="text-sm text-gray-600">
                                    <span :class="course.status === 1 ? 'text-green-600' : 'text-yellow-600'">
                                        {{ course.status === 1 ? '‚úÖ Published' : 'üìù Draft' }}
                                    </span>
                                ¬∑ Actualizado: {{ formatDate(course.updatedAt) }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Courses View -->
        <div v-if="currentView === 'courses'" class="container mx-auto px-4 py-8">
            <!-- Filters -->
            <div class="bg-white p-4 rounded-lg shadow mb-6 flex flex-wrap gap-4 items-center">
                <input
                        v-model="filters.search"
                        @input="loadCourses"
                        placeholder="Buscar cursos..."
                        class="flex-1 min-w-64 px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">

                <select
                        v-model="filters.status"
                        @change="loadCourses"
                        class="px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <option value="">Todos los estados</option>
                    <option value="0">Draft</option>
                    <option value="1">Published</option>
                </select>

                <button
                        @click="showCreateCourseModal"
                        class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition">
                    + Crear Curso
                </button>
            </div>

            <!-- Courses Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div v-for="course in courses" :key="course.id"
                     class="bg-white rounded-lg shadow hover:shadow-xl transition overflow-hidden">
                    <div class="p-6">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="text-xl font-bold flex-1">{{ course.title }}</h3>
                            <span
                                    :class="course.status === 1 ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'"
                                    class="px-3 py-1 rounded-full text-xs font-semibold">
                                    {{ course.status === 1 ? 'Published' : 'Draft' }}
                                </span>
                        </div>

                        <p class="text-sm text-gray-600 mb-4">
                            Actualizado: {{ formatDate(course.updatedAt) }}
                        </p>

                        <div class="flex flex-wrap gap-2">
                            <button
                                    @click="viewLessons(course)"
                                    class="flex-1 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition text-sm">
                                üìñ Lecciones
                            </button>
                            <button
                                    @click="editCourse(course)"
                                    class="bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 transition text-sm">
                                ‚úèÔ∏è
                            </button>
                            <button
                                    v-if="course.status === 0"
                                    @click="publishCourse(course.id)"
                                    class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition text-sm">
                                ‚úÖ
                            </button>
                            <button
                                    v-else
                                    @click="unpublishCourse(course.id)"
                                    class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition text-sm">
                                üìù
                            </button>
                            <button
                                    @click="deleteCourse(course.id)"
                                    class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition text-sm">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div v-if="pagination.totalPages > 1" class="flex justify-center items-center space-x-2 mt-8">
                <button
                        v-for="page in pagination.totalPages"
                        :key="page"
                        @click="changePage(page)"
                        :class="page === pagination.currentPage ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'"
                        class="px-4 py-2 rounded hover:bg-blue-500 hover:text-white transition">
                    {{ page }}
                </button>
            </div>
        </div>

        <!-- Course Modal -->
        <div v-if="modals.course" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl w-96 p-6">
                <h2 class="text-2xl font-bold mb-4">{{ editingCourse ? 'Editar Curso' : 'Crear Curso' }}</h2>
                <form @submit.prevent="saveCourse" class="space-y-4">
                    <input
                            v-model="courseForm.title"
                            placeholder="T√≠tulo del curso"
                            required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <div class="flex space-x-2">
                        <button
                                type="submit"
                                class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                            Guardar
                        </button>
                        <button
                                type="button"
                                @click="modals.course = false"
                                class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lessons Modal -->
        <div v-if="modals.lessons" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b p-6 flex justify-between items-center">
                    <h2 class="text-2xl font-bold">Lecciones: {{ selectedCourse?.title }}</h2>
                    <div class="flex space-x-2">
                        <button
                                @click="showCreateLessonModal"
                                class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition">
                            + Nueva Lecci√≥n
                        </button>
                        <button
                                @click="modals.lessons = false"
                                class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition">
                            Cerrar
                        </button>
                    </div>
                </div>

                <div class="p-6">
                    <div v-if="lessons.length === 0" class="text-center text-gray-500 py-8">
                        No hay lecciones a√∫n. ¬°Crea la primera!
                    </div>
                    <div v-else class="space-y-3">
                        <div v-for="lesson in lessons" :key="lesson.id"
                             class="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                            <div class="flex items-center space-x-4 flex-1">
                                <span class="text-2xl font-bold text-gray-400">#{{ lesson.order }}</span>
                                <div>
                                    <h4 class="font-semibold">{{ lesson.title }}</h4>
                                    <p class="text-sm text-gray-600">{{ formatDate(lesson.updatedAt) }}</p>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button
                                        @click="reorderLesson(lesson.id, true)"
                                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition text-sm">
                                    ‚¨ÜÔ∏è
                                </button>
                                <button
                                        @click="reorderLesson(lesson.id, false)"
                                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600 transition text-sm">
                                    ‚¨áÔ∏è
                                </button>
                                <button
                                        @click="editLesson(lesson)"
                                        class="bg-gray-300 text-gray-700 px-3 py-1 rounded hover:bg-gray-400 transition text-sm">
                                    ‚úèÔ∏è
                                </button>
                                <button
                                        @click="deleteLesson(lesson.id)"
                                        class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition text-sm">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lesson Form Modal -->
        <div v-if="modals.lessonForm" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl w-96 p-6">
                <h2 class="text-2xl font-bold mb-4">{{ editingLesson ? 'Editar Lecci√≥n' : 'Nueva Lecci√≥n' }}</h2>
                <form @submit.prevent="saveLesson" class="space-y-4">
                    <input
                            v-model="lessonForm.title"
                            placeholder="T√≠tulo de la lecci√≥n"
                            required
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <input
                            v-model.number="lessonForm.order"
                            type="number"
                            placeholder="Orden"
                            required
                            min="1"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
                    <div class="flex space-x-2">
                        <button
                                type="submit"
                                class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition">
                            Guardar
                        </button>
                        <button
                                type="button"
                                @click="modals.lessonForm = false"
                                class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition">
                            Cancelar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>